# ユースケース名
注文・発送を管理する

# 概要
管理者は受注状況を監視・更新し、出荷指示を作成して配送業者へ連携することで注文を正しく発送する。

# アクター
- 主: 管理者  
- 関連: 配送業者（外部）、倉庫システム、決済システム

# 事前条件
- 注文が作成されている。  
- 必要に応じて決済が完了している（出荷条件）。

# 事後条件
- 出荷指示が生成され配送業者へ連携される。  
- 注文の配送状態が更新され、ユーザへ通知が送信される。

# 基本フロー
1. 管理者が注文一覧を表示する。  
2. 管理者が出荷対象の注文を選択する。  
3. 管理者が出荷情報（配送先、配送方法、配送業者、梱包指示）を確認/入力する。  
4. システムが在庫を確認しピッキング指示を出す（倉庫システム連携）。  
5. システムが配送業者へ出荷依頼を送信し、追跡番号を受領する。  
6. システムが注文状態を「発送済」等に更新し、ユーザへ発送通知と追跡情報を送る。  
7. 必要に応じ管理者は発送キャンセルや再出荷を実行する。

# 代替フロー
- 在庫不足: 管理者は在庫補充・部分出荷・出荷保留のいずれかを選択する。  
- 配送業者連携失敗: システムは再試行し、規定回数失敗で管理者へエスカレーションする。  
- 支払未完了: 出荷不可とし管理者へ通知する。

# 例外処理
- 二重出荷防止: 同一注文に対する重複指示を防止する。  
- 外部API障害: リトライ、ロールバック、管理者通知を行う。  
- 権限不足: 操作を拒否しログを記録する。

# データ／出力
- 入力: 注文ID、配送先、配送方法、配送業者、梱包指示  
- 出力: 出荷指示書、配送依頼（API/ファイル）、追跡番号、発送通知

# ビジネスルール
- 決済未完了の注文は原則出荷不可。  
- 出荷後は配送業者規約に従い変更制限がある。  
- 追跡情報は取得次第速やかにユーザへ通知する。